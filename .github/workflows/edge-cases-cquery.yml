name: cquery - User Workflow with Edge Cases

on: 
    workflow_dispatch:
    release:
        types: [created]
    push:
        tags:
            - v*.*.*
jobs:
    build:
        permissions:
          id-token: write # For signing
          contents: read # For repo checkout.
          actions: read # For getting workflow run info.
        uses: enteraga6/slsa-github-generator/.github/workflows/builder_bazel_slsa3.yml@v1.0.0
        with:
            targets: "//src/... //src/internal:all" #USER INPUTTED MATERIAL
            needs-runfiles: true
            includes-java: true
    download:
            needs: [build]
            runs-on: ubuntu-latest
            steps:
            - name: Download Attestation
              uses: actions/download-artifact@v3
              with:
                name: "${{ needs.build.outputs.attestations-download-name }}"
            - name: Download Binaries 
              uses: actions/download-artifact@v3
              with:
                name: "${{ needs.build.outputs.binaries-download-name }}"
            - name: Debug
              shell: bash
              run: |
                echo "${{ needs.build.outputs.binaries-download-name.name }}"
                echo "${{ needs.build.outputs.binaries-download-name.name }}"
                echo ""
                ls -a
                
            - name: Release
              uses: softprops/action-gh-release@v1
              if: startsWith(github.ref, 'refs/tags/')
              with:
                files: |
                    "${{ needs.build.outputs.attestations-download-name.name }}"
                    "${{ needs.build.outputs.binaries-download-name.name }}"

